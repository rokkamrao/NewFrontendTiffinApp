<!-- Comprehensive Profile Page -->
<div class="min-vh-100 bg-light py-3">
  <div class="container">
    
    <!-- Profile Header -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col-auto">
            <!-- Avatar Placeholder -->
            <img src="/assets/images/avatar.png" class="rounded-circle border" 
                 style="width:80px;height:80px;object-fit:cover;" alt="Profile Avatar" />
          </div>
          
          <div class="col">
            <h4 class="mb-1">{{getUserName()}}</h4>
            <p class="text-muted mb-2">{{user?.email || 'Email not provided'}}</p>
            <div class="d-flex align-items-center gap-3">
              <span class="badge bg-success">{{user?.phone || 'Phone not provided'}}</span>
              <span class="text-muted small">Member since 2024</span>
            </div>
          </div>
          
          <div class="col-auto">
            <button class="btn btn-primary" (click)="toggleEditMode()">
              <i class="bi bi-pencil-square"></i> {{editMode ? 'Cancel' : 'Edit Profile'}}
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- Profile Information -->
      <div class="col-md-8 mb-4">
        <div class="card">
          <div class="card-header">
            <h5><i class="bi bi-person-circle"></i> Personal Information</h5>
          </div>
          <div class="card-body">
            <!-- View Mode -->
            <div *ngIf="!editMode">
              <div class="row mb-3">
                <div class="col-sm-4"><strong>Full Name:</strong></div>
                <div class="col-sm-8">{{getUserName()}}</div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-4"><strong>Email:</strong></div>
                <div class="col-sm-8">{{user?.email || 'Not provided'}}</div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-4"><strong>Dietary Preferences:</strong></div>
                <div class="col-sm-8">
                  <div *ngIf="getDietaryPreference() !== 'Not set'" class="d-flex flex-wrap gap-1">
                    <span class="badge bg-success">{{getDietaryPreference()}}</span>
                  </div>
                  <span *ngIf="getDietaryPreference() === 'Not set'" class="text-muted">{{getDietaryPreference()}}</span>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-4"><strong>Allergies:</strong></div>
                <div class="col-sm-8">
                  <span class="text-muted">No allergies specified</span>
                </div>
              </div>
            </div>

            <!-- Edit Mode -->
            <form *ngIf="editMode" [formGroup]="profileForm" (ngSubmit)="saveProfile()">
              <div class="mb-3">
                <label class="form-label">Full Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" placeholder="Enter your full name" formControlName="fullName">
              </div>

              <div class="mb-3">
                <label class="form-label">Email Address</label>
                <input type="email" class="form-control" placeholder="your.email@example.com" formControlName="email">
              </div>

              <div class="mb-3">
                <label class="form-label fw-bold">Dietary Preferences</label>
                <div class="d-flex flex-wrap gap-2">
                  <button type="button" class="btn btn-sm" 
                    [ngClass]="isDietarySelected(opt.key) ? 'btn-success' : 'btn-outline-success'" 
                    *ngFor="let opt of dietaryOptions" 
                    (click)="toggleDietary(opt.key)">
                    <span class="me-1">{{opt.icon}}</span>{{opt.label}}
                  </button>
                </div>
              </div>

              <div class="mb-4">
                <label class="form-label fw-bold">Food Allergies</label>
                <div formGroupName="allergies">
                  <div class="row g-2">
                    <div class="col-6 col-sm-4" *ngFor="let a of allergyOptions">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" [formControlName]="a" [id]="'edit_alg_'+a">
                        <label class="form-check-label" [for]="'edit_alg_'+a">{{a}}</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-success">
                  <i class="bi bi-check-lg me-2"></i>Save Changes
                </button>
                <button type="button" class="btn btn-outline-secondary" (click)="toggleEditMode()">
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="col-md-4 mb-4">
        <div class="card">
          <div class="card-header">
            <h6><i class="bi bi-lightning-charge"></i> Quick Actions</h6>
          </div>
          <div class="list-group list-group-flush">
            <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" 
                    (click)="showAddressForm = !showAddressForm">
              <span><i class="bi bi-geo-alt me-2"></i>Manage Addresses</span>
              <span class="badge bg-primary rounded-pill">{{addresses.length}}</span>
            </button>
            <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" 
                    (click)="showPaymentForm = !showPaymentForm">
              <span><i class="bi bi-credit-card me-2"></i>Payment Methods</span>
              <span class="badge bg-primary rounded-pill">{{paymentMethods.length}}</span>
            </button>
            <a class="list-group-item list-group-item-action" routerLink="/orders">
              <i class="bi bi-bag-check me-2"></i>Order History
            </a>
            <a class="list-group-item list-group-item-action" routerLink="/subscription">
              <i class="bi bi-calendar-check me-2"></i>My Subscriptions
            </a>
            <button class="list-group-item list-group-item-action text-danger" (click)="showConfirmLogout = true">
              <i class="bi bi-box-arrow-right me-2"></i>Logout
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Address Management Section -->
    <div class="row" *ngIf="showAddressForm">
      <div class="col-12 mb-4">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5><i class="bi bi-geo-alt"></i> Address Book</h5>
            <button class="btn btn-outline-secondary btn-sm" (click)="showAddressForm = false">
              <i class="bi bi-x"></i> Close
            </button>
          </div>
          <div class="card-body">
            <!-- Add Address Form -->
            <div class="border p-3 mb-3 rounded">
              <h6>Add New Address</h6>
              <form [formGroup]="addressForm" (ngSubmit)="addAddress()">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">Address Type</label>
                    <select class="form-select" formControlName="type">
                      <option value="home">Home</option>
                      <option value="work">Work</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Label</label>
                    <input type="text" class="form-control" placeholder="e.g., Home, Office" formControlName="label">
                  </div>
                  <div class="col-12">
                    <label class="form-label">Full Address</label>
                    <textarea class="form-control" rows="2" placeholder="Street address, landmark" formControlName="fullAddress"></textarea>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Pincode</label>
                    <input type="text" class="form-control" placeholder="560001" formControlName="pincode">
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">City</label>
                    <input type="text" class="form-control" placeholder="Bengaluru" formControlName="city">
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Area</label>
                    <input type="text" class="form-control" placeholder="Koramangala" formControlName="area">
                  </div>
                  <div class="col-12">
                    <button type="submit" class="btn btn-success me-2">Add Address</button>
                    <button type="button" class="btn btn-outline-secondary" (click)="addressForm.reset({ type: 'home' })">Reset</button>
                  </div>
                </div>
              </form>
            </div>

            <!-- Address List -->
            <div class="row g-3">
              <div class="col-md-6" *ngFor="let address of addresses">
                <div class="card" [class.border-primary]="address.isDefault">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                      <h6 class="mb-0">
                        {{address.label}}
                        <span *ngIf="address.isDefault" class="badge bg-primary ms-2">Default</span>
                      </h6>
                      <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                          <i class="bi bi-three-dots-vertical"></i>
                        </button>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="#" (click)="setDefaultAddress(address.id)">Set as Default</a></li>
                          <li><a class="dropdown-item text-danger" href="#" (click)="deleteAddress(address.id)">Delete</a></li>
                        </ul>
                      </div>
                    </div>
                    <p class="text-muted mb-1">{{address.fullAddress}}</p>
                    <p class="text-muted mb-0 small">{{address.area}}, {{address.city}} - {{address.pincode}}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Payment Methods Section -->
    <div class="row" *ngIf="showPaymentForm">
      <div class="col-12 mb-4">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5><i class="bi bi-credit-card"></i> Payment Methods</h5>
            <button class="btn btn-outline-secondary btn-sm" (click)="showPaymentForm = false">
              <i class="bi bi-x"></i> Close
            </button>
          </div>
          <div class="card-body">
            <!-- Add Payment Form -->
            <div class="border p-3 mb-3 rounded">
              <h6>Add Payment Method</h6>
              <form [formGroup]="paymentForm" (ngSubmit)="addPaymentMethod()">
                <div class="row g-3">
                  <div class="col-md-4">
                    <label class="form-label">Type</label>
                    <select class="form-select" formControlName="type">
                      <option value="upi">UPI</option>
                      <option value="card">Card</option>
                      <option value="wallet">Wallet</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control" placeholder="Payment name" formControlName="name">
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Details</label>
                    <input type="text" class="form-control" placeholder="UPI ID or Card ending" formControlName="details">
                  </div>
                  <div class="col-12">
                    <button type="submit" class="btn btn-success me-2">Add Payment Method</button>
                    <button type="button" class="btn btn-outline-secondary" (click)="paymentForm.reset({ type: 'upi' })">Reset</button>
                  </div>
                </div>
              </form>
            </div>

            <!-- Payment Methods List -->
            <div class="row g-3">
              <div class="col-md-6" *ngFor="let payment of paymentMethods">
                <div class="card" [class.border-primary]="payment.isDefault">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                      <div>
                        <h6 class="mb-1">{{payment.name}}</h6>
                        <p class="text-muted mb-1">{{payment.details}}</p>
                        <span *ngIf="payment.isDefault" class="badge bg-primary">Default</span>
                      </div>
                      <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                          <i class="bi bi-three-dots-vertical"></i>
                        </button>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="#" (click)="setDefaultPayment(payment.id)">Set as Default</a></li>
                          <li><a class="dropdown-item text-danger" href="#" (click)="deletePaymentMethod(payment.id)">Delete</a></li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Logout Confirmation Modal -->
<div class="modal fade" [class.show]="showConfirmLogout" [style.display]="showConfirmLogout ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Logout</h5>
        <button type="button" class="btn-close" (click)="showConfirmLogout = false"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to logout from your account?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="showConfirmLogout = false">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="logout(); showConfirmLogout = false">Yes, Logout</button>
      </div>
    </div>
  </div>
</div>
