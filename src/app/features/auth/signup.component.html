<div class="min-vh-100 bg-light py-4">
  <div class="container container-narrow">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-circle d-flex align-items-center justify-content-center text-white fw-bold" style="width:40px;height:40px;background:#4CAF50">T</div>
        <span class="fw-semibold">TiffinApp</span>
      </div>
      <a routerLink="/auth/login" class="small text-decoration-none">Already have an account? <strong>Login</strong></a>
    </div>

    <h1 class="h3 fw-bold mb-1">Join the Healthy Eating Revolution</h1>
    <p class="text-muted mb-4">Fresh, Healthy Meals Delivered Daily</p>

    <form [formGroup]="form" (ngSubmit)="submit()" novalidate class="card border-0 shadow-sm mb-4">
      <div class="card-body">

        <!-- Personal Information -->
        <h2 class="h5 fw-bold mb-3">Personal Information</h2>
        <div class="mb-3">
          <label class="form-label">Full Name <span class="text-danger">*</span></label>
          <input type="text" class="form-control" placeholder="Enter your full name" formControlName="fullName">
          <div class="form-text">As it appears on your ID</div>
          <div class="invalid-feedback d-block" *ngIf="form.get('fullName')?.touched && form.get('fullName')?.invalid">Please enter your full name</div>
        </div>

        <div class="mb-3">
          <label class="form-label">Mobile Number <span class="text-danger">*</span></label>
          <div class="input-group">
            <span class="input-group-text">ðŸ‡®ðŸ‡³ +91</span>
            <input type="tel" class="form-control" placeholder="Enter 10-digit mobile number" formControlName="phone" maxlength="10" inputmode="numeric" pattern="[0-9]*">
          </div>
          <div class="form-text">We'll send OTP for verification</div>
          <div class="invalid-feedback d-block" *ngIf="form.get('phone')?.touched && form.get('phone')?.invalid">Please enter a valid 10-digit number</div>
        </div>

        <div class="mb-4">
          <label class="form-label">Email Address <span class="text-muted">(Optional)</span></label>
          <input type="email" class="form-control" placeholder="your.email@example.com" formControlName="email">
          <div class="form-text">For order confirmations and updates</div>
          <div class="invalid-feedback d-block" *ngIf="form.get('email')?.touched && form.get('email')?.invalid">Please enter a valid email address</div>
        </div>

        <!-- Dietary Preferences -->
        <h2 class="h5 fw-bold mb-3">Dietary Preferences <span class="text-danger">*</span></h2>
        <p class="text-muted small">We'll customize your menu based on your preferences</p>
        <div class="d-flex flex-wrap gap-2 mb-2">
          <button type="button" class="btn" [ngClass]="isDietarySelected(opt.key) ? 'btn-success' : 'btn-outline-success'" *ngFor="let opt of dietaryOptions" (click)="toggleDietary(opt.key)">
            <span class="me-1">{{opt.icon}}</span>{{opt.label}}
          </button>
        </div>
        <div class="invalid-feedback d-block" *ngIf="dietaryArray.touched && dietaryArray.invalid">Please select at least one preference</div>

        <!-- Allergies -->
        <h2 class="h5 fw-bold mt-4 mb-3">Food Allergies & Restrictions <span class="text-muted">(Optional)</span></h2>
        <div formGroupName="allergies">
          <div class="row g-2 mb-2">
            <div class="col-6 col-sm-4" *ngFor="let a of allergyOptions">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" [formControlName]="a" [id]="'alg_'+a">
                <label class="form-check-label" [for]="'alg_'+a">{{a}}</label>
              </div>
            </div>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" id="alg_other" formControlName="Other">
            <label class="form-check-label" for="alg_other">Other</label>
          </div>
          <div class="mb-3">
            <input class="form-control" type="text" placeholder="Specify other restrictions" formControlName="otherText">
            <div class="form-text">Your safety is our priority</div>
          </div>
        </div>

        <!-- Delivery Location -->
        <h2 class="h5 fw-bold mt-4 mb-3">Delivery Location <span class="text-danger">*</span></h2>
        <div class="mb-3" formGroupName="address">
          <label class="form-label">Pin Code</label>
          <input class="form-control" type="tel" maxlength="6" inputmode="numeric" pattern="[0-9]*" placeholder="Enter 6-digit pincode" formControlName="pincode" (input)="onPincodeInput()">
          <div class="text-success small mt-1" *ngIf="pincodeMessage.type==='success'">{{pincodeMessage.text}}</div>
          <div class="text-danger small mt-1" *ngIf="pincodeMessage.type==='error'">{{pincodeMessage.text}}</div>
          <div class="invalid-feedback d-block" *ngIf="form.get('address.pincode')?.touched && form.get('address.pincode')?.invalid">Please enter a valid 6-digit pincode</div>
        </div>
        <div class="row g-3" formGroupName="address">
          <div class="col-12 col-sm-6">
            <label class="form-label">City</label>
            <input class="form-control" type="text" formControlName="city" placeholder="Auto-filled from pincode" readonly>
          </div>
          <div class="col-12 col-sm-6">
            <label class="form-label">Area/Locality</label>
            <select class="form-select" formControlName="area">
              <option value="" disabled>Select your area</option>
              <option *ngFor="let a of getAreas()" [value]="a">{{a}}</option>
            </select>
            <div class="invalid-feedback d-block" *ngIf="form.get('address.area')?.touched && form.get('address.area')?.invalid">Please select your area</div>
          </div>
        </div>

        <!-- Password -->
        <h2 class="h5 fw-bold mt-4 mb-3">Password Creation</h2>
        <div class="mb-3">
          <label class="form-label">Create Password <span class="text-danger">*</span></label>
          <div class="input-group">
            <input [type]="passwordVisible ? 'text' : 'password'" class="form-control" placeholder="Minimum 8 characters" formControlName="password">
            <button type="button" class="btn btn-outline-secondary" (click)="passwordVisible=!passwordVisible">{{passwordVisible ? 'Hide' : 'Show'}}</button>
          </div>
          <div class="form-text">At least 8 characters, one uppercase, one number, one special character</div>
          <div class="strength mt-2">
            <div class="bar" [ngClass]="strengthLevel()"></div>
          </div>
          <div class="invalid-feedback d-block" *ngIf="form.get('password')?.touched && form.get('password')?.errors?.['weak']">Password strength is weak</div>
        </div>
        <div class="mb-4">
          <label class="form-label">Confirm Password <span class="text-danger">*</span></label>
          <div class="input-group">
            <input [type]="confirmVisible ? 'text' : 'password'" class="form-control" placeholder="Re-enter password" formControlName="confirm">
            <button type="button" class="btn btn-outline-secondary" (click)="confirmVisible=!confirmVisible">{{confirmVisible ? 'Hide' : 'Show'}}</button>
          </div>
          <div class="invalid-feedback d-block" *ngIf="form.touched && form.errors?.['mismatch']">Passwords don't match</div>
        </div>

        <!-- Referral and Terms -->
        <div class="mb-3">
          <label class="form-label">Referral Code <span class="text-muted">(Optional)</span></label>
          <input class="form-control" placeholder="Enter code (e.g., FRIEND100)" formControlName="referral">
          <div class="text-success small mt-1" *ngIf="(form.get('referral')?.value || '').toUpperCase() === 'FRIEND100'">âœ“ Valid code! â‚¹100 discount applied</div>
        </div>

        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" id="terms" formControlName="terms">
          <label class="form-check-label" for="terms">I agree to the <a href="/terms" target="_blank">Terms of Service</a> and <a href="/privacy" target="_blank">Privacy Policy</a></label>
        </div>
        <div class="invalid-feedback d-block" *ngIf="form.get('terms')?.touched && form.get('terms')?.invalid">Please accept Terms & Conditions to continue</div>

        <div class="form-check mb-4">
          <input class="form-check-input" type="checkbox" id="newsletter" formControlName="newsletter">
          <label class="form-check-label" for="newsletter">Send me weekly meal plans, recipes, and exclusive offers</label>
        </div>

        <button type="submit" class="btn btn-success btn-lg w-100 rounded-pill" [disabled]="submitting">
          {{ submitting ? 'Creating Accountâ€¦' : 'Create Account' }}
        </button>

        <div class="d-flex align-items-center my-3">
          <div class="flex-grow-1 border-top"></div>
          <span class="px-3 text-muted small">OR</span>
          <div class="flex-grow-1 border-top"></div>
        </div>

        <div class="d-grid gap-2">
          <button type="button" class="btn btn-light border d-flex align-items-center justify-content-center gap-2">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" width="18" height="18"/>
            <span>Sign up with Google</span>
          </button>
          <button type="button" class="btn btn-primary d-flex align-items-center justify-content-center gap-2" style="background:#3b5998;border-color:#3b5998">
            <i class="bi bi-facebook"></i>
            <span>Sign up with Facebook</span>
          </button>
        </div>

        <div class="d-flex align-items-center gap-2 mt-3 text-muted small">
          <i class="bi bi-shield-lock"></i>
          <span>Your data is encrypted and secure</span>
        </div>
      </div>
    </form>

    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <h2 class="h5 fw-bold mb-3">Why Join Us?</h2>
        <ul class="list-unstyled mb-0">
          <li class="mb-2">âœ“ Nutritionist-approved meals</li>
          <li class="mb-2">âœ“ 100% plastic-free packaging</li>
          <li class="mb-2">âœ“ Flexible subscription plans</li>
          <li class="mb-2">âœ“ Cancel anytime, no questions asked</li>
          <li class="mb-2">âœ“ Track delivery in real-time</li>
        </ul>
        <div class="text-muted small mt-3">Join 10,000+ happy customers in Hyderabad</div>
      </div>
    </div>
  </div>
</div>
